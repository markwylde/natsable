# Natsable Server Configuration
# Documentation: https://docs.nats.io/running-a-nats-service/configuration

# Server identification
server_name: natsable-server

# Client connections
port: 4222

# HTTP monitoring port
http_port: 8222

# Debug and trace options (disable in production)
debug: false
trace: false
logtime: true

# Logging
log_file: "/var/log/nats/nats-server.log"

# Maximum payload size (1MB)
max_payload: 1048576

# Maximum connections
max_connections: 1000

# TLS Configuration
tls {
    cert_file: "/etc/nats/certs/server.crt"
    key_file: "/etc/nats/certs/server.key"
    ca_file: "/etc/nats/certs/ca.crt"

    # Require client certificates (mutual TLS)
    verify_and_map: true

    # Minimum TLS version
    timeout: 2.0
}

# Accounts configuration
# Each account has isolated subject namespaces
accounts {
    # System account for internal NATS operations
    SYS: {
        users: [
            {
                # System admin user - authenticated by certificate
                user: "admin@natsable.local"
            }
        ]
    }

    # Default account for regular users
    APP: {
        users: [
            {
                # User authenticated by certificate CN/email
                user: "user1@natsable.local"
                permissions: {
                    publish: {
                        allow: ["app.>", "_INBOX.>"]
                    }
                    subscribe: {
                        allow: ["app.>", "_INBOX.>"]
                    }
                }
            }
        ]

        # Account limits
        # max_connections: 100
        # max_subscriptions: 1000
        # max_payload: 1048576
    }

    # Admin account with full access
    ADMIN: {
        users: [
            {
                user: "admin@natsable.local"
                permissions: {
                    publish: ">"
                    subscribe: ">"
                }
            }
        ]
    }
}

# System account assignment
system_account: SYS

# JetStream configuration (persistent messaging)
jetstream {
    store_dir: "/data/jetstream"
    max_memory_store: 1G
    max_file_store: 10G
}

# Cluster configuration (for multi-node setup)
# cluster {
#     name: natsable-cluster
#     port: 6222
#     routes: [
#         nats-route://nats-1:6222
#         nats-route://nats-2:6222
#     ]
# }
