# Natsable Server Configuration - Development Mode
# This config uses simpler authentication for development

server_name: natsable-dev

# Client connections
port: 4222

# HTTP monitoring port (exposes /varz, /connz, /routez, /subsz, /jsz endpoints)
http_port: 8222

# Enable debug for development
debug: true
trace: false
logtime: true

# Maximum payload size (1MB)
max_payload: 1048576

# TLS Configuration
tls {
    cert_file: "/etc/nats/certs/server.crt"
    key_file: "/etc/nats/certs/server.key"
    ca_file: "/etc/nats/certs/ca.crt"

    # Verify client certificates and map CN to users
    # This enables certificate-based authentication
    verify_and_map: true
}

# Authentication configuration
authorization {
    # Default permissions for all users
    default_permissions: {
        publish: ["app.>", "_INBOX.>"]
        subscribe: ["app.>", "_INBOX.>"]
    }

    users: [
        # Certificate-based admin user (natsable app)
        # Maps to CN=admin@nats-eyes.local from admin-client.crt
        {
            user: "admin@nats-eyes.local"
            permissions: {
                publish: ">"
                subscribe: ">"
            }
        }
        # Certificate-based regular user
        # Maps to CN=user1@nats-eyes.local from user1-client.crt
        {
            user: "user1@nats-eyes.local"
            permissions: {
                publish: ">"
                subscribe: ">"
            }
        }
    ]
}

# JetStream configuration (persistent messaging)
jetstream {
    store_dir: "/data/jetstream"
    max_memory_store: 256M
    max_file_store: 1G
}

# Enable system events for monitoring
# system_account: SYS
